<!doctype html>
<script src="jquery.js"></script>
<script src="underscore.js"></script>
<script src="backbone.js"></script>
<script src="soundmanager2.js"></script>
<script src="backbone.sm2.js"></script>
<div id="player">
  <a class="play" href>play</a>
  <a class="next" href>next</a>
  <p class="current"></p>
  <ul class="queue"></ul>
</div>
<script>
  var PlayerView = Backbone.SM2.PlayerView.extend({
    el: $('#player'),

    events: {
      "click .play": function(e) {
        e.preventDefault();
        if (this.player.isPlaying()) {
          this.player.pause();
        } else {
          this.player.play();
        }
      },
      "click .next": function(e) {
        e.preventDefault();
        this.player.next();
      }
    },

    onPlay: function(sound) { this.$(".play").text('pause'); },
    onStop: function(sound) { this.$(".play").text('play'); },
    onPause: function(sound) { this.$(".play").text('play'); },

    onQueueChange: function(playable) {
      var $queue = this.$('.queue');
      $queue.html('');

      var renderQueue = function($queue, queue) {
        queue.forEach(function(item) {
          if (_.isArray(item)) {
            $newQueue = $('<ul></ul>');
            $queue.append($newQueue);
            renderQueue($newQueue, item);
          } else {
            $queue.append($('<li>' + item.id + ': ' + item.url + '</li>'));
          }
        }, this);
      };
      renderQueue = renderQueue.bind(this);
      renderQueue($queue, this.player.queue);
    }
  });

  function ready() {
    var view = new PlayerView()
    view.player.add({url: "Mark_Neil_-_11_strANGE_Ls.mp3", id: 's1'});
    view.player.add({url: "Mark_Neil_-_11_strANGE_Ls.mp3", id: 's2'});
    view.player.add({url: "Mark_Neil_-_11_strANGE_Ls.mp3", id: 's3'});
    view.player.on('all', function() {
      var args = _.toArray(arguments);
      console.log('player event: ' + args);
    });
    view.render()
  }

  soundManager.setup({url: "swf", onready: ready});
</script>
